######################################################
##
##  Starting Room
##
######################################################

:data room

	-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 
	-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 
	-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 15 15 15 15 15 15 15 15 15 15 15 15 15 15 15 15 15 15 15 15 15 15 15 15 -1 -1 -1 -1 -1 
	-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 15 10  9 11 29 11 10 28 11 14 11 11 15 15 30 30  8  8  8  8  8  8  8 15 -1 -1 -1 -1 -1 
	-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 15 12 10 28 10 14 11 11 12 10 14 28 15 15 30 30  8  8  8  8  8  8  8 15 -1 -1 -1 -1 -1 
	-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 15 10 28 13 10 29 12 10 12 13 28 12 15 15 30 30  8  8  8  8 28  8  8 15 -1 -1 -1 -1 -1 
	-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 15  9 10 28 12 11 11  8 13 12 29 12 15 15 30 30  8  8  8  8  8  8  8 15 -1 -1 -1 -1 -1 
	-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 15  5  5  1  1  1  1  1  1  1  1  1 15 15  5  5  1  1  1  1  1  1  1 15 -1 -1 -1 -1 -1 
	-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 15  5  5  1  1  1  1  1  1  1  1  1 15 15  5  5  1  1  1  1  1  1  1 15 -1 -1 -1 -1 -1 
	-1 -1 -1 -1 15 15 15 15 15 15 15 15 15  5  5  1  1  1  1  1  1  1  1  1 15 15  5  5  1  1  1  1  1  1  1 15 -1 -1 -1 -1 -1 
	-1 -1 -1 -1 15 13 11 11 29 28 11 15 15  5  5  1  1  1  1  1  1  1  1  1 28 10  5  5  1  1  1  1  1  1  1 15 -1 -1 -1 -1 -1 
	-1 -1 -1 -1 15 28 29 13 11 11 28 15 15  5  5  1  1  1  1  1  1  1  1  1 11 11  5  5  1  1  1  1  1  1  1 15 -1 -1 -1 -1 -1 
	-1 -1 -1 -1 15 28 12 28 28 12 11 28 12  5  5  1  1  1  1  1  1  1  1  1 28 11  5  6  1  1  1  1  1  1  1 15 -1 -1 -1 -1 -1 
	-1 -1 -1 -1 15 12 13 11 12 11 10 28 12  5  5  1  1  1  1  1  1  1  1  1 11 10  6  1  1  1  1  1  1  1  1 15 -1 -1 -1 -1 -1 
	-1 -1 -1 -1 15  5  5  1  1  1  1 13 11  5  6  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1 15 -1 -1 -1 -1 -1 
	-1 -1 -1 -1 15  5  5  1  1  1  1 12 28  6  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1 15 -1 -1 -1 -1 -1 
	-1 -1 -1 -1 15  5  5  1  1  1  1  7  7  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1 15 -1 -1 -1 -1 -1 
	-1 -1 -1 -1 15  5  5  1  1  1  1  7  7  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1 15 -1 -1 -1 -1 -1 
	-1 -1 -1 -1 15  5  5  1  1  1  1  7  7  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1 15 -1 -1 -1 -1 -1 
	-1 -1 -1 -1 15  5  5  1  1  1  1  7  7  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1 15 -1 -1 -1 -1 -1 
	-1 -1 -1 -1 15  5  5  1  1  1  1 15 15  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1 15 -1 -1 -1 -1 -1 
	-1 -1 -1 -1 15 15 15 15 15 15 15 15 15 15 15 15 15 15 15 15 15 15 15 15 15 15 15 15 15 15 15 15 15 15 15 15 -1 -1 -1 -1 -1 
	-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 
	-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 
	-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 
	-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 
	-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 
	-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 
	-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 
	-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 
	-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 

:var flipcnt
:var clipcnt
:var doorcnt

: janet  1 sprite-id + @ ;
: bill   2 sprite-id + @ ;
: meg    3 sprite-id + @ ;

: door1         4 sprite-id + @ ;
: door1-trigger 5 sprite-id + @ ;

:data   helo 2
:string $ "     Shouldn't you be, like,"
:string $ "     cleaning or something?"

:data   laugh 1
:string $ "     Tee hee hee!"

: janet-trigger
	janet face-player
	10 janet tile!
	helo show-text
	12 janet tile!
	laugh show-text
	8 janet tile!
;

:data   fluffles 2
:string $ " Have you seen Fluffles anywhere,"
:string $ " mister robot?"

: meg-trigger
	meg face-player
	fluffles show-text
;

: go-closet
	' main-storage-closet
	' load-storage-closet
	load-map
;

: load-starting-room

	clear-actors
	room GP !

	1 1 room >room

	16x32  0 160 120 true  player >actor
	16x32  8 120  60 true  janet  >actor
	16x32 16 250  70 true  bill   >actor
	16x32 20  60 130 false meg    >actor

	16x32           29 240 24 false door1         >actor
	48x16 invisible  0 216 56 false door1-trigger >actor

	200 flipcnt !
	300 clipcnt !

	' janet-trigger janet trigger!
	' meg-trigger   meg   trigger!
;

: main-starting-room

	loop

		# animate janet
		flipcnt @
		if
			flipcnt dec@
		else
			janet flip-horiz
			600 random 200 + flipcnt !
		then

		# animate bill
		clipcnt @
		if
			clipcnt dec@
		else
			bill tile 16 =
			if  # clipboard is currently up
				17 bill tile!
				50 clipcnt !
			else # clipboard is currently down
				16 bill tile!
				600 random 200 + clipcnt !
			then
		then

		# open and close door
		doorcnt @ 0 > if doorcnt dec@ then
		player-center door1-trigger c-sprite?
		if
			door1 tile 30 = doorcnt @ 0 = and if
				31 door1 tile!
				' go-closet door1-trigger trigger!
			then
			door1 tile 29 = if
				30 door1 tile!
				10 doorcnt !
			then
		else
			door1 tile 30 = doorcnt @ 0 = and if
				29 door1 tile!
			then
			door1 tile 31 = if
				30 door1 tile!
				0 door1-trigger trigger!
				10 doorcnt !
			then
		then

		use-logic
		use-prompt
		move-player
		sort-sprites

		sync
	again
;